<div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Advertisement</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if ad %}
                    <div class="ansi-art-container">
                        <pre class="ansi-art" id="{{ modal_id }}Ansi">{{ ad.content }}</pre>
                    </div>
                {% else %}
                    <p class="text-muted mb-0">No advertisements available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const modalEl = document.getElementById('{{ modal_id }}');
    if (!modalEl) {
        return;
    }

    modalEl.addEventListener('shown.bs.modal', () => {
        const pre = document.getElementById('{{ modal_id }}Ansi');
        if (!pre || pre.dataset.rendered) {
            return;
        }

        const renderAd = () => {
            if (typeof renderAnsiTerminal !== 'function') {
                return;
            }
            pre.innerHTML = renderAnsiTerminal(pre.textContent);
            pre.dataset.rendered = 'true';
        };

        if (typeof renderAnsiTerminal === 'function') {
            renderAd();
            return;
        }

        const script = document.createElement('script');
        script.src = '/js/ansisys.js';
        script.onload = renderAd;
        document.body.appendChild(script);
    });
});
</script>
