{# ANSI art menu variant for BBS shell #}
{% if shell_art_content %}
<div class="mb-3">
    {#
        ANSI art is 80 columns wide at a monospace font size — too wide for mobile.
        We wrap it in an overflow:hidden container and use JS to apply a CSS
        transform: scale() so it shrinks proportionally to fit the viewport.
        On desktop the art renders at natural size.
    #}
    <div class="ansi-art-wrapper d-flex justify-content-center" style="overflow:hidden;">
        <pre class="ansi-art" id="shellMenuAnsi" style="transform-origin:top center; display:inline-block;">{{ shell_art_content }}</pre>
    </div>

    {# Touch-friendly menu links shown only on mobile (below the art) #}
    {% set menuItems = appearance.shell.bbs_menu.menu_items %}
    <div class="d-md-none mt-3">
        <div class="list-group">
            {% for item in menuItems %}
            <a href="{{ item.url | e }}" class="list-group-item list-group-item-action d-flex align-items-center gap-2 py-3">
                <span class="badge bg-primary fs-6" style="min-width:2rem;">{{ item.key | upper | e }}</span>
                <i class="fas fa-{{ item.icon | default('circle') | e }} text-primary"></i>
                {{ item.label | e }}
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<script>
(function() {
    function scaleAnsiArt() {
        var pre = document.getElementById('shellMenuAnsi');
        if (!pre) return;
        var wrapper = pre.closest('.ansi-art-wrapper');
        if (!wrapper) return;
        // Reset so we can measure natural width
        pre.style.transform = '';
        wrapper.style.height = '';
        var naturalWidth = pre.scrollWidth;
        var availWidth = wrapper.clientWidth;
        if (naturalWidth > availWidth && availWidth > 0) {
            var scale = availWidth / naturalWidth;
            pre.style.transform = 'scale(' + scale + ')';
            // transform doesn't affect layout flow — shrink the wrapper to match
            wrapper.style.height = Math.ceil(pre.scrollHeight * scale) + 'px';
        }
    }
    // Run after ANSI rendering (which happens in a separate ready handler)
    $(document).ready(function() {
        // Small delay so the ANSI renderer has run first
        setTimeout(scaleAnsiArt, 50);
    });
    $(window).on('resize', scaleAnsiArt);
})();
</script>

{% else %}
{# No ANSI file configured — fall back to text menu #}
{% include 'shells/bbs-menu/main-menu-text.twig' %}
{% endif %}
