{# ANSI art menu variant for BBS shell #}
{% if shell_art_content %}
<div class="mb-3">
    {#
        ANSI art is 80 columns wide at a monospace font size — too wide for mobile.
        We wrap it in an overflow:hidden container and use JS to apply a CSS
        transform: scale() so it shrinks proportionally to fit the viewport.
        On desktop the art renders at natural size.
    #}
    <div class="ansi-art-wrapper d-flex justify-content-center" id="ansiArtWrapper" style="cursor:pointer;">
        <pre class="ansi-art" id="shellMenuAnsi" style="display:inline-block;">{{ shell_art_content }}</pre>
    </div>

    {#
        Shortcut links — hidden by default, revealed when the user clicks/taps
        the ANSI art above. Using display:none (not a Bootstrap breakpoint class)
        so it never auto-shows based on viewport width alone.
    #}
    {% set menuItems = appearance.shell.bbs_menu.menu_items %}
    <div id="ansiTouchLinks" class="mt-3" style="display:none;">
        <div class="list-group">
            {% for item in menuItems %}
            <a href="{{ item.url | e }}" class="list-group-item list-group-item-action d-flex align-items-center gap-2 py-3">
                <span class="badge bg-primary fs-6" style="min-width:2rem;">{{ item.key | upper | e }}</span>
                <i class="fas fa-{{ item.icon | default('circle') | e }} text-primary"></i>
                {{ item.label | e }}
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<script>
(function() {
    function scaleAnsiArt() {
        var pre = document.getElementById('shellMenuAnsi');
        if (!pre) return;
        var wrapper = pre.closest('.ansi-art-wrapper');
        if (!wrapper) return;
        // Reset any previous scaling
        pre.style.fontSize = '';
        var isMobile = window.matchMedia('(max-width: 767.98px)').matches;
        var targetWidth = isMobile
            ? Math.floor(window.innerWidth * 0.99)
            : wrapper.clientWidth;
        var naturalWidth = pre.scrollWidth;
        // Mobile: scale to fill (up or down); desktop: only scale down if too wide
        if (targetWidth > 0 && naturalWidth > 0 && (isMobile || naturalWidth > targetWidth)) {
            var currentFontSize = parseFloat(window.getComputedStyle(pre).fontSize);
            pre.style.fontSize = (currentFontSize * targetWidth / naturalWidth).toFixed(2) + 'px';
        }
    }
    // Run after ANSI rendering (which happens in a separate ready handler)
    $(document).ready(function() {
        // Small delay so the ANSI renderer has run first
        setTimeout(scaleAnsiArt, 50);

        // Clicking/tapping the ANSI art toggles the shortcut link list
        var wrapper = document.getElementById('ansiArtWrapper');
        var links = document.getElementById('ansiTouchLinks');
        if (wrapper) {
            wrapper.addEventListener('click', function() {
                if (links) {
                    links.style.display = links.style.display === 'none' ? 'block' : 'none';
                }
            });
        }
    });
    $(window).on('resize', scaleAnsiArt);
})();
</script>

{% else %}
{# No ANSI file configured — fall back to text menu #}
{% include 'shells/bbs-menu/main-menu-text.twig' %}
{% endif %}
